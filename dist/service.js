!function(){"use strict";const e=require("@patrickkfkan/peer-dial"),t=require("express"),n=require("cors"),o=t(),a="YouTube";let i,p;try{i=tizen.application.getAppInfo().packageId,p=`${i}.TizenBrewStandalone`}catch(e){console.error("CRITICAL: Could not get Tizen package ID.",e)}o.use(n({origin:"*",methods:"GET,HEAD,PUT,PATCH,POST,DELETE",credentials:!0,optionsSuccessStatus:204}));const r={[a]:{name:a,state:"stopped",allowStop:!0,pid:null,additionalData:{},launch(e){if(!p)return void console.error("Cannot launch app: TizenBrew App ID is not set.");const t=new tizen.ApplicationControlData("module",[JSON.stringify({moduleName:"opaayush/tizentube",moduleType:"gh",args:e})]),n=new tizen.ApplicationControl("http://tizen.org/appcontrol/operation/view",null,null,null,[t]);tizen.application.launchAppControl(n,p)}}},s=new e.Server({expressApp:o,port:8085,prefix:"/dial",manufacturer:"OpAayush",modelName:"TizenBrew",friendlyName:"TizenTube",delegate:{getApp:e=>r[e],launchApp(e,t,n){console.log(`Got request to launch ${e} with launch data: ${t}`);const o=r[e];if(!o)return console.warn(`Request to launch unknown app: ${e}`),n(null);const a=Object.fromEntries(new URLSearchParams(t));if(a.yumi)return o.additionalData=a,o.state="running",n("");o.pid="run",o.state="starting",o.launch(t),o.state="running",n(o.pid)},stopApp(e,t,n){console.log(`Got request to stop ${e} with pid: ${t}`);const o=r[e];if(!o)return console.warn(`Request to stop unknown app: ${e}`),n(!1);o.pid===t?(o.pid=null,o.state="stopped",n(!0)):(console.warn(`PID mismatch while stopping ${e}.`),n(!1))}}});setInterval(()=>{p&&tizen.application.getAppsContext(e=>{const t=e.some(e=>e.appId===p);t||"running"!==r[a].state||(console.log("TizenBrew app is not running. Setting state to stopped."),r[a].state="stopped",r[a].pid=null,r[a].additionalData={})})},5e3),s.start(),console.log("TizenTube DIAL server started on port 8085")}();
